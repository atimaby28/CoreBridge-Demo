import{d as Q,o as W,r as p,c as n,b as t,i as f,t as l,n as k,q as v,j as _,v as X,A as Z,B as E,F as A,s as L,p as tt,g as T,h as et,l as i}from"./index-BwYT7rAB.js";import{b as st,g as lt,E as ot}from"./audit-Dv0oy9no.js";const at={class:"min-h-screen bg-gray-50 p-6"},rt={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6"},nt={class:"bg-white rounded-lg shadow p-4"},it={class:"text-2xl font-bold text-blue-600"},dt={class:"bg-white rounded-lg shadow p-4"},ut={class:"text-2xl font-bold text-red-600"},xt={class:"bg-white rounded-lg shadow p-4"},vt={class:"bg-white rounded-lg shadow p-4"},gt={class:"text-2xl font-bold text-gray-700"},pt={class:"bg-white rounded-lg shadow p-4"},mt={class:"text-2xl font-bold text-gray-700"},ct={class:"bg-white rounded-lg shadow p-4 mb-6"},yt={class:"flex flex-wrap gap-4 items-end"},bt={class:"flex-[2] min-w-[200px]"},ft={class:"flex-1 min-w-[150px]"},wt=["value"],ht={class:"flex-1 min-w-[150px]"},kt=["value"],_t={class:"flex-1 min-w-[130px]"},Tt={class:"bg-white rounded-lg shadow overflow-hidden"},Ct={class:"overflow-x-auto"},St={class:"min-w-full divide-y divide-gray-200"},Nt={class:"bg-white divide-y divide-gray-200"},Et={key:0,class:"text-center"},At={key:1,class:"text-center"},Lt={class:"px-4 py-3 text-sm text-gray-500 whitespace-nowrap"},Pt={class:"px-4 py-3 text-sm"},Ut={class:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800"},qt={class:"px-4 py-3 text-sm text-gray-700"},Ft={class:"px-4 py-3 text-sm"},It=["title"],Mt={class:"px-4 py-3 text-sm"},Dt={class:"px-4 py-3 text-sm text-gray-500"},Rt={class:"px-4 py-3 text-sm text-gray-500"},Bt={class:"px-4 py-3 text-sm"},Vt=["onClick"],jt={class:"bg-gray-50 px-4 py-3 flex items-center justify-between border-t border-gray-200"},zt={class:"text-sm text-gray-700"},Ht={class:"font-medium"},Jt={class:"font-medium"},Kt={class:"font-medium"},Ot={class:"flex gap-2"},$t=["disabled"],Gt={class:"px-3 py-1 text-gray-600"},Yt=["disabled"],Qt={class:"bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto"},Wt={class:"p-6"},Xt={class:"flex justify-between items-center mb-4"},Zt={class:"space-y-4"},te={class:"grid grid-cols-2 gap-4"},ee={class:"font-mono text-sm"},se={class:"font-mono text-sm bg-gray-100 p-2 rounded break-all"},le={key:0},oe={class:"text-xs bg-gray-100 p-2 rounded overflow-x-auto max-h-40"},ae={key:1},re={class:"text-red-600 bg-red-50 p-2 rounded"},ne={key:2},ie={class:"text-xs text-gray-500 break-all"},w=20,ve=Q({__name:"AuditLogView",setup(de){const h=p([]),x=p([]),u=p(null),a=p(null),C=p(!1),d=p(0),r=p({keyword:"",serviceName:"",eventType:"",statusFilter:"all"}),M=ot,D=v(()=>{const s=new Set(h.value.map(e=>e.serviceName));return Array.from(s).sort()}),R=v(()=>{const s=d.value*w;return x.value.slice(s,s+w)}),S=v(()=>Math.ceil(x.value.length/w)||1),B=v(()=>x.value.length===0?0:d.value*w+1),V=v(()=>Math.min((d.value+1)*w,x.value.length)),P=v(()=>!u.value||!u.value.totalRequests?"0.00":(u.value.errorCount/u.value.totalRequests*100).toFixed(2)),j=v(()=>{const s=parseFloat(P.value);return s<1?"text-green-600":s<5?"text-yellow-600":"text-red-600"}),z=v(()=>!u.value||!u.value.avgExecutionTime?"-":u.value.avgExecutionTime.toFixed(0));W(async()=>{await H()});async function H(){C.value=!0;try{const[s,e]=await Promise.all([st(0,500),lt()]);h.value=s.audits,x.value=s.audits,u.value=e}catch(s){console.error("Failed to load audits:",s)}finally{C.value=!1}}function U(){d.value=0;let s=h.value;if(r.value.keyword.trim()){const e=r.value.keyword.toLowerCase().trim();s=s.filter(g=>{var m,c,y,b;return((m=g.requestUri)==null?void 0:m.toLowerCase().includes(e))||((c=g.userEmail)==null?void 0:c.toLowerCase().includes(e))||((y=g.clientIp)==null?void 0:y.toLowerCase().includes(e))||((b=g.serviceName)==null?void 0:b.toLowerCase().includes(e))})}r.value.serviceName&&(s=s.filter(e=>e.serviceName===r.value.serviceName)),r.value.eventType&&(s=s.filter(e=>e.eventType===r.value.eventType)),r.value.statusFilter==="success"?s=s.filter(e=>e.httpStatus>=200&&e.httpStatus<400):r.value.statusFilter==="error"&&(s=s.filter(e=>e.httpStatus>=400)),x.value=s}function J(){r.value={keyword:"",serviceName:"",eventType:"",statusFilter:"all"},d.value=0,x.value=h.value}function K(){d.value>0&&d.value--}function O(){d.value<S.value-1&&d.value++}function $(s){a.value=s}function q(s){return new Date(s).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function G(s){try{return JSON.stringify(JSON.parse(s),null,2)}catch{return s}}function Y(s){return{GET:"bg-green-100 text-green-800",POST:"bg-blue-100 text-blue-800",PUT:"bg-yellow-100 text-yellow-800",PATCH:"bg-orange-100 text-orange-800",DELETE:"bg-red-100 text-red-800"}[s]||"bg-gray-100 text-gray-800"}function F(s){return s>=200&&s<300?"bg-green-100 text-green-800":s>=300&&s<400?"bg-yellow-100 text-yellow-800":s>=400&&s<500?"bg-orange-100 text-orange-800":s>=500?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}return(s,e)=>{var g,m,c,y,b,I;return i(),n("div",at,[e[40]||(e[40]=t("div",{class:"mb-6"},[t("h1",{class:"text-2xl font-bold text-gray-900"},"감사 로그"),t("p",{class:"text-gray-600 mt-1"},"시스템 전체 API 호출 기록을 조회합니다")],-1)),t("div",rt,[t("div",nt,[e[6]||(e[6]=t("div",{class:"text-sm text-gray-500"},"총 요청",-1)),t("div",it,l(((m=(g=u.value)==null?void 0:g.totalRequests)==null?void 0:m.toLocaleString())??"-"),1)]),t("div",dt,[e[7]||(e[7]=t("div",{class:"text-sm text-gray-500"},"에러 수",-1)),t("div",ut,l(((y=(c=u.value)==null?void 0:c.errorCount)==null?void 0:y.toLocaleString())??"-"),1)]),t("div",xt,[e[8]||(e[8]=t("div",{class:"text-sm text-gray-500"},"에러율",-1)),t("div",{class:k(["text-2xl font-bold",j.value])},l(P.value)+"% ",3)]),t("div",vt,[e[9]||(e[9]=t("div",{class:"text-sm text-gray-500"},"고유 사용자",-1)),t("div",gt,l(((I=(b=u.value)==null?void 0:b.uniqueUsers)==null?void 0:I.toLocaleString())??"-"),1)]),t("div",pt,[e[10]||(e[10]=t("div",{class:"text-sm text-gray-500"},"평균 응답시간",-1)),t("div",mt,l(z.value)+"ms",1)])]),t("div",ct,[t("div",yt,[t("div",bt,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"검색",-1)),_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.keyword=o),type:"text",placeholder:"URI, 이메일, IP 검색...",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500",onKeyup:Z(U,["enter"])},null,544),[[X,r.value.keyword]])]),t("div",ft,[e[13]||(e[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"서비스",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.serviceName=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"},[e[12]||(e[12]=t("option",{value:""},"전체",-1)),(i(!0),n(A,null,L(D.value,o=>(i(),n("option",{key:o,value:o},l(o),9,wt))),128))],512),[[E,r.value.serviceName]])]),t("div",ht,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"이벤트",-1)),_(t("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.eventType=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"},[e[14]||(e[14]=t("option",{value:""},"전체",-1)),(i(!0),n(A,null,L(tt(M),(o,N)=>(i(),n("option",{key:N,value:N},l(o),9,kt))),128))],512),[[E,r.value.eventType]])]),t("div",_t,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"상태",-1)),_(t("select",{"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.statusFilter=o),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-blue-500 focus:border-blue-500"},[...e[16]||(e[16]=[t("option",{value:"all"},"전체",-1),t("option",{value:"success"},"성공 (2xx)",-1),t("option",{value:"error"},"에러 (4xx, 5xx)",-1)])],512),[[E,r.value.statusFilter]])]),t("button",{onClick:U,class:"px-5 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition flex items-center gap-2"},[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1),T(" 검색 ",-1)])]),t("button",{onClick:J,class:"px-4 py-2 bg-gray-100 text-gray-600 rounded-md hover:bg-gray-200 transition"}," 초기화 ")])]),t("div",Tt,[t("div",Ct,[t("table",St,[e[21]||(e[21]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"시간"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"서비스"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"이벤트"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"메서드"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"URI"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"상태"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"실행시간"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"사용자"),t("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"액션")])],-1)),t("tbody",Nt,[C.value?(i(),n("tr",Et,[...e[19]||(e[19]=[t("td",{colspan:"9",class:"px-4 py-8 text-gray-500"},"로딩 중...",-1)])])):x.value.length===0?(i(),n("tr",At,[...e[20]||(e[20]=[t("td",{colspan:"9",class:"px-4 py-8 text-gray-500"},"검색 결과가 없습니다",-1)])])):f("",!0),(i(!0),n(A,null,L(R.value,o=>(i(),n("tr",{key:o.auditId,class:"hover:bg-gray-50"},[t("td",Lt,l(q(o.createdAt)),1),t("td",Pt,[t("span",Ut,l(o.serviceName),1)]),t("td",qt,l(o.eventTypeName),1),t("td",Ft,[t("span",{class:k([Y(o.httpMethod),"px-2 py-1 text-xs font-medium rounded"])},l(o.httpMethod),3)]),t("td",{class:"px-4 py-3 text-sm text-gray-600 max-w-xs truncate",title:o.requestUri},l(o.requestUri),9,It),t("td",Mt,[t("span",{class:k([F(o.httpStatus),"px-2 py-1 text-xs font-medium rounded-full"])},l(o.httpStatus),3)]),t("td",Dt,l(o.executionTime)+"ms",1),t("td",Rt,l(o.userEmail||"-"),1),t("td",Bt,[t("button",{onClick:N=>$(o),class:"text-blue-600 hover:text-blue-800"}," 상세 ",8,Vt)])]))),128))])])]),t("div",jt,[t("div",zt,[e[22]||(e[22]=T(" 총 ",-1)),t("span",Ht,l(x.value.length),1),e[23]||(e[23]=T("개 중 ",-1)),t("span",Jt,l(B.value),1),e[24]||(e[24]=T(" - ",-1)),t("span",Kt,l(V.value),1)]),t("div",Ot,[t("button",{onClick:K,disabled:d.value===0,class:"px-3 py-1 border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"}," 이전 ",8,$t),t("span",Gt,l(d.value+1)+" / "+l(S.value),1),t("button",{onClick:O,disabled:d.value>=S.value-1,class:"px-3 py-1 border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-100"}," 다음 ",8,Yt)])])]),a.value?(i(),n("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:e[5]||(e[5]=et(o=>a.value=null,["self"]))},[t("div",Qt,[t("div",Wt,[t("div",Xt,[e[25]||(e[25]=t("h3",{class:"text-lg font-bold"},"로그 상세",-1)),t("button",{onClick:e[4]||(e[4]=o=>a.value=null),class:"text-gray-400 hover:text-gray-600 text-2xl"}," × ")]),t("div",Zt,[t("div",te,[t("div",null,[e[26]||(e[26]=t("label",{class:"text-sm text-gray-500"},"ID",-1)),t("div",ee,l(a.value.auditId),1)]),t("div",null,[e[27]||(e[27]=t("label",{class:"text-sm text-gray-500"},"생성 시간",-1)),t("div",null,l(q(a.value.createdAt)),1)]),t("div",null,[e[28]||(e[28]=t("label",{class:"text-sm text-gray-500"},"서비스",-1)),t("div",null,l(a.value.serviceName),1)]),t("div",null,[e[29]||(e[29]=t("label",{class:"text-sm text-gray-500"},"이벤트 타입",-1)),t("div",null,l(a.value.eventTypeName),1)]),t("div",null,[e[30]||(e[30]=t("label",{class:"text-sm text-gray-500"},"HTTP 메서드",-1)),t("div",null,l(a.value.httpMethod),1)]),t("div",null,[e[31]||(e[31]=t("label",{class:"text-sm text-gray-500"},"HTTP 상태",-1)),t("div",null,[t("span",{class:k([F(a.value.httpStatus),"px-2 py-1 text-xs font-medium rounded-full"])},l(a.value.httpStatus),3)])]),t("div",null,[e[32]||(e[32]=t("label",{class:"text-sm text-gray-500"},"실행 시간",-1)),t("div",null,l(a.value.executionTime)+"ms",1)]),t("div",null,[e[33]||(e[33]=t("label",{class:"text-sm text-gray-500"},"사용자 ID",-1)),t("div",null,l(a.value.userId??"-"),1)]),t("div",null,[e[34]||(e[34]=t("label",{class:"text-sm text-gray-500"},"사용자 이메일",-1)),t("div",null,l(a.value.userEmail??"-"),1)]),t("div",null,[e[35]||(e[35]=t("label",{class:"text-sm text-gray-500"},"클라이언트 IP",-1)),t("div",null,l(a.value.clientIp??"-"),1)])]),t("div",null,[e[36]||(e[36]=t("label",{class:"text-sm text-gray-500"},"Request URI",-1)),t("div",se,l(a.value.requestUri),1)]),a.value.requestBody?(i(),n("div",le,[e[37]||(e[37]=t("label",{class:"text-sm text-gray-500"},"Request Body",-1)),t("pre",oe,l(G(a.value.requestBody)),1)])):f("",!0),a.value.errorMessage?(i(),n("div",ae,[e[38]||(e[38]=t("label",{class:"text-sm text-gray-500"},"에러 메시지",-1)),t("div",re,l(a.value.errorMessage),1)])):f("",!0),a.value.userAgent?(i(),n("div",ne,[e[39]||(e[39]=t("label",{class:"text-sm text-gray-500"},"User Agent",-1)),t("div",ie,l(a.value.userAgent),1)])):f("",!0)])])])])):f("",!0)])}}});export{ve as default};
