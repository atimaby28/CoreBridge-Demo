import{d as H,o as J,c as r,b as t,i as L,r as o,t as l,n as y,j as M,v as Q,A as W,F as X,s as Z,p as I,B as T,y as g,l as u}from"./index-BwYT7rAB.js";function A(d,b="full"){if(!d)return"-";const i=typeof d=="string"?new Date(d):d;if(isNaN(i.getTime()))return"-";switch(b){case"date":return i.toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit"});case"time":return i.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"});case"relative":return tt(i);case"full":default:return i.toLocaleDateString("ko-KR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}}function tt(d){const i=new Date().getTime()-d.getTime(),f=Math.floor(i/1e3),c=Math.floor(f/60),n=Math.floor(c/60),p=Math.floor(n/24);return f<60?"방금 전":c<60?`${c}분 전`:n<24?`${n}시간 전`:p<7?`${p}일 전`:A(d,"date")}const et={class:"space-y-6"},st={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-4"},at={class:"card text-center"},lt={class:"text-2xl font-bold text-gray-900"},nt={class:"card text-center"},ot={class:"text-2xl font-bold text-green-600"},it={class:"card text-center"},rt={class:"text-2xl font-bold text-blue-600"},ut={class:"card text-center"},dt={class:"text-2xl font-bold text-red-600"},ct={class:"card"},vt={class:"flex flex-col md:flex-row md:items-center md:justify-between space-y-4 md:space-y-0"},mt={class:"flex space-x-2"},bt={class:"flex space-x-2"},ft={class:"card"},pt={key:0,class:"py-12 text-center text-gray-500"},xt={key:1,class:"py-12 text-center text-red-500"},yt={key:2,class:"py-12 text-center text-gray-500"},gt={key:3,class:"overflow-x-auto"},_t={class:"w-full"},ht={class:"py-4"},kt={class:"flex items-center space-x-3"},Ct={class:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center"},Et={class:"text-primary-700 font-medium"},Rt={class:"font-medium text-gray-900"},wt={class:"text-sm text-gray-500"},Lt={class:"py-4"},Ot={class:"py-4"},Mt={class:"py-4 text-sm text-gray-500"},At={class:"py-4 text-sm text-gray-500"},Ut={class:"py-4"},Dt={class:"flex space-x-2"},St=["onClick"],Nt=["onClick"],$t={key:4,class:"flex justify-center items-center space-x-2 mt-6"},It=["disabled"],Tt={class:"text-sm text-gray-600"},Bt=["disabled"],Vt={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Kt={class:"bg-white rounded-xl p-6 w-full max-w-md"},jt={class:"text-sm text-gray-500 mb-4"},Pt={class:"flex justify-end space-x-2"},Yt={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},zt={class:"bg-white rounded-xl p-6 w-full max-w-md"},Ft={class:"text-sm text-gray-500 mb-4"},qt={class:"flex justify-end space-x-2"},Ht=H({__name:"UserManageView",setup(d){const b=o([]),i=o(null),f=o(!0),c=o(""),n=o(0),p=o(20),_=o(0),B=o(0),h=o(""),m=o(""),k=o(!1),C=o(!1),v=o(null),E=o("ROLE_USER"),R=o("ACTIVE"),V={ROLE_USER:"일반회원",ROLE_COMPANY:"기업회원",ROLE_ADMIN:"관리자"},K={ACTIVE:"활성",BLOCKED:"차단",DELETED:"탈퇴"};async function O(){try{i.value=await g.getStats()}catch(s){console.error("통계 로드 실패:",s)}}async function x(){f.value=!0,c.value="";try{let s;h.value?s=await g.searchUsers(h.value,n.value,p.value):m.value?s=await g.getUsersByRole(m.value,n.value,p.value):s=await g.getAllUsers(n.value,p.value),b.value=s.users,_.value=s.totalPages,B.value=s.totalCount}catch(s){c.value=s instanceof Error?s.message:"사용자 목록을 불러오는데 실패했습니다."}finally{f.value=!1}}function U(){n.value=0,x()}function w(s){m.value=s,h.value="",n.value=0,x()}function D(s){s>=0&&s<_.value&&(n.value=s,x())}function j(s){v.value=s,E.value=s.role,k.value=!0}function P(s){v.value=s,R.value=s.status,C.value=!0}async function Y(){if(v.value)try{await g.updateRole(v.value.userId,{role:E.value}),k.value=!1,x(),O()}catch(s){alert(s instanceof Error?s.message:"역할 변경에 실패했습니다.")}}async function z(){if(v.value)try{await g.updateStatus(v.value.userId,{status:R.value}),C.value=!1,x(),O()}catch(s){alert(s instanceof Error?s.message:"상태 변경에 실패했습니다.")}}function F(s){switch(s){case"ROLE_ADMIN":return"badge-purple";case"ROLE_COMPANY":return"badge-blue";default:return"badge-gray"}}function q(s){switch(s){case"ACTIVE":return"badge-green";case"BLOCKED":return"badge-red";default:return"badge-gray"}}return J(()=>{O(),x()}),(s,e)=>{var S,N;return u(),r("div",et,[e[20]||(e[20]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"사용자 관리"),t("p",{class:"text-gray-500"},"전체 사용자를 관리하고 권한을 설정하세요.")],-1)),i.value?(u(),r("div",st,[t("div",at,[t("p",lt,l(i.value.totalUsers),1),e[11]||(e[11]=t("p",{class:"text-sm text-gray-500"},"전체 사용자",-1))]),t("div",nt,[t("p",ot,l(i.value.activeUsers),1),e[12]||(e[12]=t("p",{class:"text-sm text-gray-500"},"활성 사용자",-1))]),t("div",it,[t("p",rt,l(i.value.companyCount),1),e[13]||(e[13]=t("p",{class:"text-sm text-gray-500"},"기업 회원",-1))]),t("div",ut,[t("p",dt,l(i.value.blockedUsers),1),e[14]||(e[14]=t("p",{class:"text-sm text-gray-500"},"차단 사용자",-1))])])):L("",!0),t("div",ct,[t("div",vt,[t("div",mt,[t("button",{onClick:e[0]||(e[0]=a=>w("")),class:y(["btn btn-sm",m.value===""?"btn-primary":"btn-outline"])}," 전체 ",2),t("button",{onClick:e[1]||(e[1]=a=>w("ROLE_USER")),class:y(["btn btn-sm",m.value==="ROLE_USER"?"btn-primary":"btn-outline"])}," 일반회원 ",2),t("button",{onClick:e[2]||(e[2]=a=>w("ROLE_COMPANY")),class:y(["btn btn-sm",m.value==="ROLE_COMPANY"?"btn-primary":"btn-outline"])}," 기업회원 ",2),t("button",{onClick:e[3]||(e[3]=a=>w("ROLE_ADMIN")),class:y(["btn btn-sm",m.value==="ROLE_ADMIN"?"btn-primary":"btn-outline"])}," 관리자 ",2)]),t("div",bt,[M(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),type:"text",placeholder:"이메일 또는 닉네임 검색",class:"input w-64",onKeyup:W(U,["enter"])},null,544),[[Q,h.value]]),t("button",{onClick:U,class:"btn btn-primary"},"검색")])])]),t("div",ft,[f.value?(u(),r("div",pt," 로딩 중... ")):c.value?(u(),r("div",xt,l(c.value),1)):b.value.length===0?(u(),r("div",yt," 사용자가 없습니다. ")):(u(),r("div",gt,[t("table",_t,[e[15]||(e[15]=t("thead",null,[t("tr",{class:"text-left text-sm text-gray-500 border-b"},[t("th",{class:"pb-3 font-medium"},"사용자"),t("th",{class:"pb-3 font-medium"},"역할"),t("th",{class:"pb-3 font-medium"},"상태"),t("th",{class:"pb-3 font-medium"},"가입일"),t("th",{class:"pb-3 font-medium"},"마지막 로그인"),t("th",{class:"pb-3 font-medium"},"관리")])],-1)),t("tbody",null,[(u(!0),r(X,null,Z(b.value,a=>{var $;return u(),r("tr",{key:a.userId,class:"border-b border-gray-100 last:border-0"},[t("td",ht,[t("div",kt,[t("div",Ct,[t("span",Et,l((($=a.nickname)==null?void 0:$.charAt(0))||"U"),1)]),t("div",null,[t("p",Rt,l(a.nickname),1),t("p",wt,l(a.email),1)])])]),t("td",Lt,[t("span",{class:y(["badge",F(a.role)])},l(V[a.role]),3)]),t("td",Ot,[t("span",{class:y(["badge",q(a.status)])},l(K[a.status]),3)]),t("td",Mt,l(I(A)(a.createdAt,"date")),1),t("td",At,l(a.lastLoginAt?I(A)(a.lastLoginAt,"relative"):"-"),1),t("td",Ut,[t("div",Dt,[t("button",{onClick:G=>j(a),class:"text-sm text-primary-600 hover:text-primary-700"}," 역할 변경 ",8,St),t("button",{onClick:G=>P(a),class:"text-sm text-gray-600 hover:text-gray-700"}," 상태 변경 ",8,Nt)])])])}),128))])])])),_.value>1?(u(),r("div",$t,[t("button",{onClick:e[5]||(e[5]=a=>D(n.value-1)),disabled:n.value===0,class:"btn btn-outline btn-sm"}," 이전 ",8,It),t("span",Tt,l(n.value+1)+" / "+l(_.value),1),t("button",{onClick:e[6]||(e[6]=a=>D(n.value+1)),disabled:n.value>=_.value-1,class:"btn btn-outline btn-sm"}," 다음 ",8,Bt)])):L("",!0)]),k.value?(u(),r("div",Vt,[t("div",Kt,[e[17]||(e[17]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"역할 변경",-1)),t("p",jt,l((S=v.value)==null?void 0:S.nickname)+"님의 역할을 변경합니다. ",1),M(t("select",{"onUpdate:modelValue":e[7]||(e[7]=a=>E.value=a),class:"input mb-4"},[...e[16]||(e[16]=[t("option",{value:"ROLE_USER"},"일반회원",-1),t("option",{value:"ROLE_COMPANY"},"기업회원",-1),t("option",{value:"ROLE_ADMIN"},"관리자",-1)])],512),[[T,E.value]]),t("div",Pt,[t("button",{onClick:e[8]||(e[8]=a=>k.value=!1),class:"btn btn-outline"},"취소"),t("button",{onClick:Y,class:"btn btn-primary"},"변경")])])])):L("",!0),C.value?(u(),r("div",Yt,[t("div",zt,[e[19]||(e[19]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"상태 변경",-1)),t("p",Ft,l((N=v.value)==null?void 0:N.nickname)+"님의 상태를 변경합니다. ",1),M(t("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>R.value=a),class:"input mb-4"},[...e[18]||(e[18]=[t("option",{value:"ACTIVE"},"활성",-1),t("option",{value:"BLOCKED"},"차단",-1)])],512),[[T,R.value]]),t("div",qt,[t("button",{onClick:e[10]||(e[10]=a=>C.value=!1),class:"btn btn-outline"},"취소"),t("button",{onClick:z,class:"btn btn-primary"},"변경")])])])):L("",!0)])}}});export{Ht as default};
